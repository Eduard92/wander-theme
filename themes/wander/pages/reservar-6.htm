title = "Reservar 6"
url = "/reservar/resumen"
layout = "layout"
is_hidden = 0
robot_index = "noindex"
robot_follow = "nofollow"

[procesoReserva]

[Paises]
==
{% put pagetitle %}Resumen{% endput %}
{% put metatitle %}Conoce nuestras cabañas en renta petfriendly en Valle de Bravo y Malinalco{% endput %}
{% put metadescription %}Reserva la experiencia Wander en una de nuestras cabañas en medio de la naturaleza. Ingresa a nuestro sitio, elige tu fecha favorita y ¡listo! Alístate junto con tu pareja, familia, amigos y hasta tu mascota, somos pet friendly. ¡Te esperamos!{% endput %}

{% put scriptreserva %}
<script type="text/javascript" src="{{'assets/js/scripts/scriptReservar.js'|theme}}"></script>
<script src="https://polyfill.io/v3/polyfill.min.js?version=3.52.1&features=fetch"></script>
<script type="text/javascript" src="{{'assets/js/scripts/cupones.js'|theme}}"></script>


{% endput %}

    <script type="text/javascript">
      let totalHospedaje = '{{totalHospedaje}}';
      let totalServicios = '{{totalServicios}}';
      let total = '{{total}}';
      
      let totalFinal = '{{total}}';

    </script>
<style>
  .Promo__container__wyI9w {
    font-size: 14px;
    margin-bottom: 20px;
}

.Promo__label__xG8nP {
    display: block;
    font-size: 14px;
    font-weight: 600;
    margin-bottom: 5px;
}
.Promo__wrapper__vQUV1 {
    border: 1px solid #272728;
    display: flex;
}

.Promo__desktopWrapper__72N74 {
    border: 1px solid #8f8e8d;
    margin-bottom: 8px;
}
p

.Promo__desktopInput__szr8d {
    font-size: 16px;
    height: 64px;
}

.Promo__input__f1ybK {
    border: none;
    flex: 1 1;
    /*font-size: 1.2rem;*/
    padding: 15px;
}
@media (min-width:600px){
    .Promo__input__f1ybK {
    font-size: 1.2rem;
}
}

.Promo__button__CoSJA {
    background: none;
    border: none;
    color: #0C282A;
    cursor: pointer;
    font-weight: 600;
    min-width: auto;
    padding: 0 15px;
}
.Promo__desktopButton__cqQCD {
    font-size: 12px;
}

.Promo__buttonInner__n5-z9 {
    -webkit-font-smoothing: antialiased;
    border-bottom: 2px solid #0C282A;
    cursor: pointer;
}

/* *, :after, :before {
    box-sizing: inherit;
}*/
.Promo__button__CoSJA {
    background: none;
    border: none;
    color: #0C282A;
    cursor: pointer;
    font-weight: 600;
    min-width: auto;
    padding: 0 15px;
}
.Promo__desktopButton__cqQCD {
    font-size: 12px;
}

.codeError{
  color: #f50000;
    font-weight: 600;
}
.codeOk{
  color: #0C282A;
    font-weight: 600;
}



.newbtn{
    background-color: #F1B23F;
    border: solid 1px #F1B23F;
    color: #ffffff;
    max-width:80%;
    max-width:100%
    letter-spacing: 1.2px;
        font-size: 1rem;
    cursor: pointer;
    text-transform: uppercase;
    text-decoration: none;
    font-family: "Oswald", sans-serif;
    font-weight: 500;
    min-width:300px;
}
.newbtn:hover{
    background-color: #EA7F26;
    border: solid 1px #EA7F26;
}

.aplazo{
    letter-spacing: 1.2px;
        background-color: #7fedfa;
            border: solid 1px #7fedfa;

            font-size: 1rem;
    cursor: pointer;
    text-transform: uppercase;
    text-decoration: none;
    font-family: "Oswald", sans-serif;
    font-weight: 500;
    width:300px
    }
    
    
    .aplazo:hover{
        background-color: #4cc1cf;
            border: solid 1px #4cc1cf;
}
    
  </style>
  
<article class="bg-gen">
  <div class="reservaCt">
    <div class="descReservar">
      <!--<img src="{{ 'assets/img/logos/logo-wander-white-text.svg'|theme }}" alt="Wander">-->
      <h2>REVISA TU RESERVA</h2>
    </div>
    {{ form_ajax('onReserva', {class: 'stepReservaFrm', id: 'frmResumen',     'data-request-success': 'onReservaSuccess(data)'}) }}
    
      <div class="wizard">
        <div class="steps clearfix">
          <ul role="tablist">
            <li role="tab" class="first done" aria-disabled="false" aria-selected="true">
              <a id="steps-uid-0-t-0" href="{{'reservar-1'|page}}" aria-controls="steps-uid-0-p-0">Paso 1</a>
            </li>
            <li role="tab" class="done" aria-disabled="true">
              <a id="steps-uid-0-t-1" href="{{'reservar-2'|page}}" aria-controls="steps-uid-0-p-1">Paso 2</a>
            </li>
            <li role="tab" class="done" aria-disabled="true">
              <a id="steps-uid-0-t-2" href="{{'reservar-3'|page}}" aria-controls="steps-uid-0-p-2">Paso 3</a>
            </li>
            <li role="tab" class="done" aria-disabled="true">
              <a id="steps-uid-0-t-3" href="{{'reservar-4'|page}}" aria-controls="steps-uid-0-p-3">Paso 4</a>
            </li>
            <li role="tab" class="done" aria-disabled="true">
              <a id="steps-uid-0-t-4" href="{{'reservar-5'|page}}" aria-controls="steps-uid-0-p-4">Paso 5</a>
            </li>
            <li role="tab" class="current" aria-disabled="true">
              <a id="steps-uid-0-t-5" href="{{''|page}}" aria-controls="steps-uid-0-p-5">Paso 6</a>
            </li>
            <li role="tab" class="disabled last" aria-disabled="true">
              <a id="steps-uid-0-t-6" href="#" aria-controls="steps-uid-0-p-6">Paso 7</a>
            </li>
          </ul><!-- end.ul -->
        </div><!-- end.steps -->
        <div class="content clearfix">
        
        
         <section>
          <div class="detallecompra">
            <div class="container">
              <div class="row justify-content-center">
                <!--div class="col-12">
                  <div class="descBoxCabinsNew">
                    <p>Estás por completar tu reservación, <strong>confirma</strong> las condiciones de tu estancia,<br>
                    conoce las <strong>políticas y reglas</strong> y dejanos conocer al resto de los huéspedes.</p>
                  </div><-- end.descBoxCabinsNew --
                </div><-- end.col-* -->
                <div class="col-12 col-md-8 col-lg-6">
                {% flash %}
                    <div class="alert alert-danger">
                        {{ message }}
                    </div>
                {% endflash %}
                
                  <!--div class="detailBox">
                    <div class="dateDetail" style="text-align: center;">
                    
                      {% if noches == 1 %}
                          <div class="h2">{{noches}} noche en {{ubicacion.nombre}}</div>
                          <input type="hidden" id="ubicacion_nombre" value="{{ubicacion.nombre}}">
                      {% elseif noches > 1 %}
                          <div class="h2">{{noches}} noches en {{ubicacion.nombre}}</div>
                          <input type="hidden" id="ubicacion_nombre" value="{{ubicacion.nombre}}">
                      {% endif %}
                      
                    </div><!-- end.dateDetail ->
                    <p align="center"><b>{{start}} al {{end}}</b></p>

                    <!-h2 class="precioFinal">TOTAL ${{total|number_format}} MXN</h2->
                  </div><!-- end.detailBox -->
                  <div class="newDetails">
                    <div>
                      <div>
                        <h3 style="text-align: center;">
                          Desglose de pago
                        </h3>
                      </div><!-- end.card-header -->
                      <div id="accInpt-1"  aria-labelledby="title-list-1" data-parent="#accInputsRes">
                        <div class="card-body extrasInp">
                  
                          <div class="extrasInp__box">
                            <div class="extrasInp__icon">
                              <img src="{{ 'assets/img/imgPrueba/wander_icon.svg'|theme }}" alt="Wander">
                            </div><!-- end.extrasCt__icon -->
                            <div class="extrasInp__desc">
                            <input class="cabana_type" id="cabana_type" type="hidden" value="{{cabana.nombre}}">
                              {% set guest = adultos + ninos %}

                              <h3>Cabaña {{cabana.nombre}} - {{guest}} Huespedes</h3>
                          
                              {% for key, dia in dias %}
                              <div class="descExtrasInp">
                                <p>Noche {{loop.index}} - {{dia}}</p>
                                <span class="precio">${{precios[key]|number_format(2, '.', ',') }}</span>
                              </div>
                              {% endfor %}
                              <!--<div class="descExtrasInp">
                                <p>Martes 15 de Junio</p>
                                <span class="precio">$33</span>
                              </div>
                              <div class="descExtrasInp">
                                <p>Miercoles 16 de Junio</p>
                                <span class="precio">$33</span>
                              </div>-->
                            </div><!-- end.extrasInp__desc -->
                          </div><!-- end.extrasInp__box -->
                          

                          {% if ninos > 0 %}
                          <div class="extrasInp__box">
                            <div class="extrasInp__icon">
                              <img src="{{ detalleninos.foto.path }}" alt="{{detalleninos.nombre}}">
                            </div><!-- end.extrasCt__icon -->
                            <div class="extrasInp__desc">
                              <h3>{{detalleninos.nombre}} - {{ninos}} Niño(s)</h3>
                              <div class="descExtrasInp">
                                <p>Por estadia completa</p>
                                <span class="precio">${{detalleninos.precio_sab*ninos|number_format(2, '.', ',') }}</span>
                              </div>
                            </div><!-- end.extrasInp__desc -->
                          </div><!-- end.extrasInp__box -->
                          {% endif %}
                          
                          {% if mascotas > 0 %}
                          <div class="extrasInp__box">
                            <div class="extrasInp__icon">
                              <img src="{{ detallemascotas.foto.path }}" alt="{{detallemascotas.nombre}}">
                            </div><!-- end.extrasCt__icon -->
                            <div class="extrasInp__desc">
                              <h3>{{detallemascotas.nombre}}</h3>
                              <div class="descExtrasInp">
                                <p>Por estadia completa</p>
                                <span class="precio">${{detallemascotas.precio_sab|number_format(2, '.', ',') }}</span>
                              </div>
                            </div><!-- end.extrasInp__desc -->
                          </div><!-- end.extrasInp__box -->
                          {% endif %}

                          {% for servicio in services %}
                          {% if servicio.tipo == 'extended' %}
                          <div class="extrasInp__box">
                            <div class="extrasInp__icon">
                            </div><!-- end.extrasCt__icon -->
                            <div class="extrasInp__desc">
                              <h3>{{servicio.nombre}}</h3>
                              <div class="descExtrasInp">
                                <p></p>
                                <span class="precio">${{servicio.precio_sab|number_format(2, '.', ',') }}</span>
                              </div>
                            </div><!-- end.extrasInp__desc -->
                          </div><!-- end.extrasInp__box -->
                          {% elseif servicio.tipo == 'actividad' %}
                          <div class="extrasInp__box">
                            <div class="extrasInp__icon">
                              <img src="{{ servicio.foto.path }}" alt="{{ servicio.nombre}}">
                            </div><!-- end.extrasCt__icon -->
                            <div class="extrasInp__desc">
                              <h3 class="servicio_adicional">{{servicio.nombre}}</h3>
                               {% if servicio.tipo_cobro  == 'Hora' %}
                                <div class="descExtrasInp">
                                   <p>Cantidad: {{servicios[servicio.id].cantidad}} | Horas:{{servicios[servicio.id].dias}}</p>
                                   <span class="precio">${{servicio.precio_sab*servicios[servicio.id].cantidad*servicios[servicio.id].dias|number_format(2, '.', ',') }}</span>
                                </div>
                              {% elseif servicio.tipo_cobro  == 'Paquete' %}
                                <div class="descExtrasInp">
                                   <p>Cantidad: {{servicios[servicio.id].cantidad}}</p>
                                   <span class="precio">${{servicio.precio_sab*servicios[servicio.id].cantidad*servicios[servicio.id].dias|number_format(2, '.', ',') }}</span>
                                </div>
                              {% else%}
                                <div class="descExtrasInp">
                                  <p>Cantidad: {{servicios[servicio.id].cantidad}} | Días:{{servicios[servicio.id].dias}}</p>
                                  <span class="precio">${{servicio.precio_sab*servicios[servicio.id].cantidad*servicios[servicio.id].dias|number_format(2, '.', ',') }}</span>
                                </div>
                              {% endif %}
                            </div><!-- end.extrasInp__desc -->
                          </div><!-- end.extrasInp__box -->
                        {% elseif servicio.tipo == 'alimentos' %}
                          <div class="extrasInp__box">
                            <div class="extrasInp__icon">
                              <img src="{{ servicio.foto.path }}" alt="{{ servicio.nombre}}">
                            </div><!-- end.extrasCt__icon -->
                            <div class="extrasInp__desc">
                              <h3 class="servicio_adicional">{{servicio.nombre}}</h3>
                               {% if servicio.tipo_cobro  == 'Hora' %}
                                <div class="descExtrasInp">
                                   <p>Cantidad: {{servicios[servicio.id].cantidad}} | Horas:{{servicios[servicio.id].dias}}</p>
                                   <span class="precio">${{servicio.precio_sab*servicios[servicio.id].cantidad*servicios[servicio.id].dias|number_format(2, '.', ',') }}</span>
                                </div>
                              {% elseif servicio.tipo_cobro  == 'Paquete' %}
                                <div class="descExtrasInp">
                                   <p>Cantidad: {{servicios[servicio.id].cantidad}}</p>
                                   <span class="precio">${{servicio.precio_sab*servicios[servicio.id].cantidad*servicios[servicio.id].dias|number_format(2, '.', ',') }}</span>
                                </div>
                              {% else%}
                                <div class="descExtrasInp">
                                  <p>Cantidad: {{servicios[servicio.id].cantidad}} | Días:{{servicios[servicio.id].dias}}</p>
                                  <span class="precio">${{servicio.precio_sab*servicios[servicio.id].cantidad*servicios[servicio.id].dias|number_format(2, '.', ',') }}</span>
                                </div>
                              {% endif %}
                            </div><!-- end.extrasInp__desc -->
                          </div><!-- end.extrasInp__box -->
                          {% elseif servicio.tipo == 'amenidades' %}
                          <div class="extrasInp__box">
                            <div class="extrasInp__icon">
                              <img src="{{ servicio.foto.path }}" alt="{{ servicio.nombre}}">
                            </div><!-- end.extrasCt__icon -->
                            <div class="extrasInp__desc">
                              <h3 class="servicio_adicional">{{servicio.nombre}}</h3>
                                <div class="descExtrasInp">
                                  <p>Días:{{servicio.dias}}</p>
                                  <span class="precio">${{servicio.precio_sab*servicio.dias|number_format(2, '.', ',') }}</span>
                                </div>
                            </div><!-- end.extrasInp__desc -->
                          </div><!-- end.extrasInp__box -->
                          {% elseif servicio.tipo == 'kit' %}
                          <div class="extrasInp__box">
                            <div class="extrasInp__icon">
                              <img src="{{ servicio.foto.path }}" alt="{{servicio.nombre}}">
                            </div><!-- end.extrasCt__icon -->
                            <div class="extrasInp__desc">
                              <h3 class="servicio_adicional" >{{servicio.nombre}}</h3>
                              <div class="descExtrasInp">
                                <p>1 Kit</p>
                                <span class="precio">${{servicio.precio_sab|number_format(2, '.', ',') }}</span>
                              </div>
                            </div><!-- end.extrasInp__desc -->
                          </div><!-- end.extrasInp__box -->
                          {% endif %}
                          {% endfor %}

                          <div class="extrasInp__box" id="divCupon" style="display:none;">
                            <div class="extrasInp__icon">
                              <!--<img src="{{ 'assets/img/imgPrueba/percent.svg'|theme }}" alt="Impuesto">-->
                            </div><!-- end.extrasCt__icon -->
                            <div class="extrasInp__desc">
                              <h3>Descuento</h3>
                              <div class="descExtrasInp">
                                <p id="cuponDesc"></p>
                                <span id="cuponDescMoney" class="precio"></span>
                              </div>
                            </div><!-- end.extrasInp__desc -->
                          </div><!-- end.extrasInp__box -->   
     
     
                          <div class="extrasInp__box">
                            <div class="extrasInp__icon">
                              <!--<img src="{{ 'assets/img/imgPrueba/percent.svg'|theme }}" alt="Impuesto">-->
                            </div><!-- end.extrasCt__icon -->
                            <div class="extrasInp__desc">
                              <h3>Impuestos</h3>
                              <div class="descExtrasInp">
                                <p>IVA. 16%</p>
                                <span class="precio" id="montoIva">${{iva|number_format(2, '.', ',') }}</span>
                              </div>
                            </div><!-- end.extrasInp__desc -->
                          </div><!-- end.extrasInp__box -->
                          
                          <div class="Promo__container__wyI9w">
                              <h3>Código de Promoción</h3>
                              <div class="Promo__wrapper__vQUV1 Promo__desktopWrapper__72N74">
                                  <input class="Promo__input__f1ybK Promo__desktopInput__szr8d" type="text" placeholder="Ingrese Cupón" name="promoCode" id="promoCode" value="" />
                                  <button class="Promo__button__CoSJA Promo__desktopButton__cqQCD" id='aplicarCupon' onclick="aplicar()" type="button"><span class="Promo__buttonInner__n5-z9">APLICAR</span></button>
                                  <button class="Promo__button__CoSJA Promo__desktopButton__cqQCD" id='quitarCupon' onclick="quitar()" type="button" style="display: none; color:#830000"><span class="Promo__buttonInner__n5-z9">BORRAR</span></button>
                              </div>
                              <p class="codeError" id="codeError"></p>
                              <p class="codeOk" id="codeOk"></p>
                          </div>
                      
                          <div class="h2 precioFinal">TOTAL ${{total|number_format(2, '.', ',') }} MXN</div><!-- end.precio -->
                          <!--<div class="ctBtnAcc">
                          {% if not user %}
                            <a class="btn BtnNext collapsed" href="#" data-open-modal="">Siguiente</a>
                          {% else %}
                            <a data-toggle="collapse" data-toggle="collapse" data-parent="#accInputsRes" href="#accInpt-2" class="btn BtnNext collapsed">Siguiente</a>
                          {% endif %}
                          </div> -->
                        </div><!-- end.card-body -->
                      </div><!-- end.collapse -->
                    </div><!-- end.card -->
                  </div><!--- end .newDetails-->
                  <div class="contAccordionBox">
                    <div class="accordion accInputList" id="accInputsRes" aria-multiselectable="true">
                      <div class="card">
                        <div class="card-header" id="title-list-3">
                          <div class="h2 mb-0">
                            <button class="btn btn-link btn-block text-left btnResAcc collapsed" type="button" data-toggle="collapse" aria-expanded="false" aria-controls="accInpt-3">
                              HUÉSPEDES
                            </button>
                          </div>
                        </div>
                        <div id="accInpt-3" class="panel-collapse " aria-labelledby="title-list-3" data-parent="#accInputsRes">
                          <div class="card-body huesCont">
                            <div class="huesCont__desc">
                              <p>Agrega los datos de todos los huéspedes.</p>
                            </div><!-- huesCont__desc -->

                            {% for i in 1..adultos %}
                                {% if i == 1 %}
                                    <div class="huesCont__box" data-frm-inp="huesped-{{i}}">
                                      <h4>Adulto 1 (titular)</h4>

                                      <div class="form-group row">
                                        <label for="nombre-1" class="col-4 col-sm-3 col-md-4 col-xl-3 col-form-label">Correo Electrónico</label>
                                        <div class="col-8 col-sm-9 col-md-8 col-xl-9">
                                          <input type="email" class="form-control nameResInp" id="email" name="email"        autocomplete="off"  onblur="search()" list="email-suggestions" required>
                                            <datalist id="email-suggestions"></datalist>

                                        </div>
                                      </div>
                                      
                                      <div class="form-group row">
                                        <label for="nombre-1" class="col-4 col-sm-3 col-md-4 col-xl-3 col-form-label">Nombre</label>
                                        <div class="col-8 col-sm-9 col-md-8 col-xl-9">
                                          <input type="text" class="form-control nameResInp" id="nombre_1" name="nombre_1" onblur="guardar()"  required>
                                        </div>
                                      </div>
                                      
                                      
                                      <div class="form-group row">
                                        <label for="nombre-1" class="col-4 col-sm-3 col-md-4 col-xl-3 col-form-label">Apellidos</label>
                                        <div class="col-8 col-sm-9 col-md-8 col-xl-9">
                                          <input type="text" class="form-control nameResInp" id="apellido_1" name="apellido_1" onblur="guardar()"  required>
                                        </div>
                                      </div>
                                      
                                      <!--div class="form-group row">
                                        <label for="dd-1" class="col-4 col-sm-3 col-md-4 col-xl-3 col-form-label">Fecha de nacimiento</label>
                                        <div class="col-8 col-sm-9 col-md-8 col-xl-9">
                                        <input type="number" class="form-control" name="dd_1" id="dd_1" maxlength="2" pattern="[0-9]{2}" placeholder="DD"   style="width:30%;float:left;" required onblur="guardar()" min="1" max="31">
                                        <input type="number" class="form-control" name="mm_1" id="mm_1" maxlength="2" pattern="[0-9]{2}" placeholder="MM"   style="width:30%;float:left;" required onblur="guardar()" min="1" max="12">
                                        <input type="number" class="form-control" name="aa_1" id="aa_1" maxlength="4" pattern="[0-9]{4}" placeholder="AAAA" style="width:40%;float:left;" required onblur="guardar()" min="1900" max="2100" >

                                        </div>
                                      </div-->
                                      
                                      <div class="form-group row">
                                      <label for="dd_1" class="col-4 col-sm-3 col-md-4 col-xl-3 col-form-label">Fecha de nacimiento</label>
                                      <div class="col-8 col-sm-9 col-md-8 col-xl-9">
                                        <select class="form-control" name="dd_1" id="dd_1" required onblur="guardar()" style="width:30%;float:left;">
                                          <option value="">DD</option>
                                          <!-- Días 1-31 -->
                                          <option value="1">1</option>
                                          <option value="2">2</option>
                                          <option value="3">3</option>
                                          <option value="4">4</option>
                                          <option value="5">5</option>
                                          <option value="6">6</option>
                                          <option value="7">7</option>
                                          <option value="8">8</option>
                                          <option value="9">9</option>
                                          <option value="10">10</option>
                                          <option value="11">11</option>
                                          <option value="12">12</option>
                                          <option value="13">13</option>
                                          <option value="14">14</option>
                                          <option value="15">15</option>
                                          <option value="16">16</option>
                                          <option value="17">17</option>
                                          <option value="18">18</option>
                                          <option value="19">19</option>
                                          <option value="20">20</option>
                                          <option value="21">21</option>
                                          <option value="22">22</option>
                                          <option value="23">23</option>
                                          <option value="24">24</option>
                                          <option value="25">25</option>
                                          <option value="26">26</option>
                                          <option value="27">27</option>
                                          <option value="28">28</option>
                                          <option value="29">29</option>
                                          <option value="30">30</option>
                                          <option value="31">31</option>
                                        </select>
                                    
                                        <select class="form-control" name="mm_1" id="mm_1" required onblur="guardar()" style="width:30%;float:left;">
                                          <option value="">MM</option>
                                          <option value="1">Enero</option>
                                          <option value="2">Febrero</option>
                                          <option value="3">Marzo</option>
                                          <option value="4">Abril</option>
                                          <option value="5">Mayo</option>
                                          <option value="6">Junio</option>
                                          <option value="7">Julio</option>
                                          <option value="8">Agosto</option>
                                          <option value="9">Septiembre</option>
                                          <option value="10">Octubre</option>
                                          <option value="11">Noviembre</option>
                                          <option value="12">Diciembre</option>
                                        </select>
                                    
                                        <input type="number" class="form-control" name="aa_1" id="aa_1" placeholder="AAAA"
                                               style="width:40%;float:left;" required onblur="guardar()" min="1900" max="2100">
                                      </div>
                                    </div>

                                      
                                        <div class="form-group row">
                                      
                                        <label for="telefono-1" class="col-4 col-sm-3 col-md-4 col-xl-3 col-form-label">Teléfono</label>
                                    


                                        <div  class="col-4 col-sm-3 col-md-4 col-xl-3">
                                                <select id="countrySelect"   class="js-example-templating form-control" name="codeCountry" required >
                                                    <option value="">Selecciona un país</option>
                                                    {% for country in paises %}
                                                        <option value="{{ country.name }}"  data-country-code="{{country.code}}" data-calling-code="{{ country.callingCodes }}">  + {{ country.callingCodes }}  {{ country.name }}</option>
                                                    {% endfor %}
                                                </select>

                                                <input type="hidden" name="callingCode" id="callingCode">
                                                <input type="hidden" name="countryCode" id="countryCode">
        
                                        </div>
                                        
                                        <div class="col-8 col-sm-6 col-md-8 col-xl-6">
                                          <input type="number" style="width:100%"class="form-control" name="telefono_1" id="telefono_1" maxlength="10" pattern="[0-9]{10}"required  onblur="guardar()" >
                                        </div>
                                      </div>     
                                      
                                      
                                                                          
                                      <div class="form-group row">
                                        <label for="cp" class="col-6 col-sm-6 col-md-6 col-xl-3 col-form-label">Código Postal</label>
                                        <div class="col-6 col-sm-9 col-md-8 col-xl-9">
                                          <input type="number" class="form-control" name="cp" id="cp" maxlength="5" pattern="[0-9]{5}"required style="width:50%" onblur="guardar()" >
                                        </div>
                                      </div>
                                      
                                      
                                    </div>
                                {% else %}
                                    <div class="huesCont__box" data-frm-inp="huesped-{{i}}">
                                      <h4>Adulto {{i}}</h4>
                                      <div class="form-group row">
                                        <label for="nombre-{{i}}" class="col-4 col-sm-3 col-md-4 col-xl-3 col-form-label">Nombre completo</label>
                                        <div class="col-8 col-sm-9 col-md-8 col-xl-9">
                                          <input type="text" class="form-control nameResInp" id="nombre-{{i}}" name="nombres[]">
                                        </div>
                                      </div>
                                      <div class="form-group row">
                                        <label for="edad-{{i}}" class="col-4 col-sm-3 col-md-4 col-xl-3 col-form-label">Edad</label>
                                        <div class="col-8 col-sm-9 col-md-8 col-xl-9">
                                          <input type="text" class="form-control" name="edades[]" maxlength="2" id="edad-{{i}}" style="width:30%;" required>
                                        </div>
                                      </div>
                                    </div>
                                {% endif %}
                            {% endfor %}
                            
                            {% if ninos > 0 %}
                                {% for i in 1..ninos %}
                                    <div class="huesCont__box" data-frm-inp="nino-{{i}}">
                                      <h4>Niño {{i}}</h4>
                                      <div class="form-group row">
                                        <label for="nino-{{i}}" class="col-4 col-sm-3 col-md-4 col-xl-3 col-form-label">Nombre completo</label>
                                        <div class="col-8 col-sm-9 col-md-8 col-xl-9">
                                          <input type="text" class="form-control nameResInpChild" id="nino-{{i}}" name="ninos[]">
                                        </div>
                                      </div>
                                      <div class="form-group row">
                                        <label for="nino-edad-{{i}}" class="col-4 col-sm-3 col-md-4 col-xl-3 col-form-label">Edad</label>
                                        <div class="col-8 col-sm-9 col-md-8 col-xl-9">
                                          <input type="text" class="form-control nameResInpChild" name="ninoedades[]" maxlength="2" id="nino-edad-{{i}}" style="width:30%;" required>
                                        </div>
                                      </div>
                                    </div>
                                {% endfor %}
                            {% endif %}
                            
                            <!--<div class="ctBtnAcc">
                              <a data-toggle="collapse" data-parent="#accInputsRes" href="#accInpt-2" class="btn BtnBack">Atrás</a>
                            </div> -->
                          </div><!-- end.crad-body -->
                        </div><!-- end.collapse -->
                      </div><!-- end.card -->
                      <div class="card">
                        <div class="card-header" id="title-list-2">
                          <div class=" h2 mb-0">
                            <button class="btn btn-link btn-block text-left btnResAcc collapsed" type="button" data-toggle="collapse" aria-expanded="false" aria-controls="accInpt-2">
                              POLÍTICAS Y REGLAS
                            </button>
                          </div>
                        </div>
                        <div id="accInpt-2" class="panel-collapse collapse show" aria-labelledby="title-list-2" data-parent="#accInputsRes">
                          <div class="card-body">
                            <div class="contPolicy">
                    
                              <h5 class="contPolicy__title">Política de cancelación</h5>
                              <div class="contPolicy_desc">
                                <p>No hay reembolsos, sin embargo puede cambiar la fecha de su reservación hasta 5 días antes para otra ocasión que pueda venir, siempre y cuando
                                  contemos con disponibilidad.</p>
                              </div><!-- end.contPolicy_desc -->
                              <h5 class="contPolicy__title">Reglas</h5>
                              <div class="contPolicy_desc">
                                <p>Los términos y condiciones</p>
                                <ul>
                                  <li>
                                    <p><i class="fa fa-times"></i> Se permite fumar</p> <span>No</span>
                                  </li>
                                  <li>
                                    <p><i class="fa fa-check"></i> Mascotas permitidas (Aplica Cargos Adicionales)</p> <span>Si</span>
                                  </li>
                                </ul><br>
                              </div><!-- end.contPolicy_desc -->
                              
                             <h5 class="contPolicy__title">Transporte</h5>
                              <div class="contPolicy_desc" >
                               <p><b>Te recomendamos viajar en un auto que te permita desplazarte en terracería ya que el acceso a todas nuestras cabañas será por caminos de tierra.</b></p>
                              </div>
 
                             <h5 class="contPolicy__title">Terminos y Condiciones</h5>
                              <div class="contPolicy_desc" >
                                <fieldset class="form-group" style="text-align:unset; margin-bottom: 1rem;">
                                  <input type="checkbox" class="CheckStyle" id="resAcepto" name="resAcepto" required>
                                  <label for="resAcepto">He leído y acepto todas las condiciones y políticas de alquiler.</label> <a href="/terminos-y-condiciones" target="_blank"><i class="fa fa-eye"></i></a>
                                </fieldset>
                              </div>
                              
                              <h5 class="contPolicy__title">Deslinde de Responsabilidad</h5>
                              <div class="contPolicy_desc">
                                <fieldset class="form-group" style="text-align:unset; margin-bottom: 1rem;">
                                  <input type="checkbox" class="CheckStyle" id="resDeslinde" name="resDeslinde" required>
                                  <label for="resDeslinde">He leído y acepto el deslinde de responsabilidad.</label> <a href="/deslinde-de-responsabilidad" target="_blank"><i class="fa fa-eye"></i></a>

                                </fieldset>
                              </div>
                              
                            </div><!-- end.contPolicy -->
                            <!-- <div class="ctBtnAcc">
                              <a data-toggle="collapse" data-parent="#accInputsRes" href="#accInpt-1" class="btn BtnBack">Atrás</a>
                            {% if user %}
                              <a data-toggle="collapse" data-toggle="collapse" data-parent="#accInputsRes" href="#accInpt-3" class="btn BtnNext collapsed">Siguiente</a>
                            {% endif %}
                            </div>end.ctBtnAcc -->
                          </div><!-- end.card-body -->
                        </div><!-- end.collapse -->
                      </div><!-- end.card -->
                      <div class="card">
                        <div class="card-header" id="title-list-4">
                          <div class="h2 mb-0">
                            <button class="btn btn-link btn-block text-left btnResAcc" type="button" data-toggle="collapse" aria-expanded="false" aria-controls="accInpt-4">
                              MÉTODO DE PAGO
                            </button>
                          </div>
                        </div>
                        <div id="accInpt-4" class="panel-collapse" aria-labelledby="title-list-4" data-parent="#accInputsRes">
                          <div class="card-body payMet">
                            <div class="payMet__desc">
                              <p>Seleccione su Método de Pago.</p>
                            </div><!-- huesCont__desc -->
                            
                              <div class="d-flex flex-column gap-3 align-items-center w-100">
                               <input type="hidden" name="resMetodo" id="resMetodo">

                                 <!-- Tarjeta con Stripe -->
                                <button type="submit" class="btn btnpr btnpr__primary--border newbtn align-items-center justify-content-center p-3"
                                        onclick="document.getElementById('resMetodo').value='tarjeta'">
                                  <i class="fa fa-credit-card mr-2"></i> Tarjeta de Crédito / Débito 
                                  <img src="https://upload.wikimedia.org/wikipedia/commons/b/ba/Stripe_Logo%2C_revised_2016.svg" 
                                       alt="Stripe" style="height:20px; margin-left:8px;">
                                </button>

                            {% if diasFaltantes > 5%}
                                <!-- Transferencia con Stripe -->
                                <button type="submit" class="btn btnpr btnpr__primary--border newbtn align-items-center justify-content-center p-3"
                                        onclick="document.getElementById('resMetodo').value='transferencia'">
                                  <i class="fa fa-bank mr-2"></i> Transferencia Bancaria 
                                  <img src="https://upload.wikimedia.org/wikipedia/commons/b/ba/Stripe_Logo%2C_revised_2016.svg" 
                                       alt="Stripe" style="height:20px; margin-left:8px;">
                                </button>

                            {% endif %}
                            
                            {% if diasFaltantes > 14 and total <  10000 %}
                                <!-- Transferencia con oxxx -->
                                <button type="submit" class="btn btnpr btnpr__primary--border newbtn align-items-center justify-content-center p-3"
                                        onclick="document.getElementById('resMetodo').value='oxxo'">
                                  <i class="fa fa-bank mr-2"></i> Oxxo 
                                  <img src="https://upload.wikimedia.org/wikipedia/commons/b/ba/Stripe_Logo%2C_revised_2016.svg" 
                                       alt="Stripe" style="height:20px; margin-left:8px;">
                                </button>
                            {% endif %}
                            
                            
                                <button type="submit" class="btn btnpr btnpr__primary--border newbtn aplazo align-items-center justify-content-center p-3"
                                        onclick="document.getElementById('resMetodo').value='aplazo'">
                                  <i class="fa fa-credit-card mr-2"></i> Paga en mensualidades 
                                  <img src="https://aplazo.invasor.mx/img/logo.png?1758758956" 
                                       alt="Aplazo" style="height:20px; margin-left:8px;">
                                </button>
    
                              </div><!-- flex flex-column -->

                            <!--fieldset class="form-group">
                              <input type="radio" class="CheckStyle" id="resMetodoCard" name="resMetodo"  value="tarjeta" required>
                               <label for="resMetodoCard"> <i class="fa fa-credit-card"></i> Tarjeta de Crédito / Débito</label>
                            </fieldset>

                            {% if diasFaltantes > 5%}
                            <fieldset class="form-group">
                              <input type="radio" class="CheckStyle" id="resMetodotrans" name="resMetodo" value="transferencia" required>
                               <label for="resMetodotrans"> <i class="fa fa-bank"></i> Transferencia Bancaria</label>
                            </fieldset>
                            {% endif %}
                            
                            {% if diasFaltantes > 14 and total <  10000 %}
                            <fieldset class="form-group">
                              <input type="radio" class="CheckStyle" id="resMetodoOxxo" name="resMetodo" value="oxxo" required>
                               <label for="resMetodoOxxo"> <i class="fa fa-ticket" ></i> Oxxo</label>
                            </fieldset>
                            {% endif %}
                            -->
                            

                            <!--<div class="ctBtnAcc">
                              <a data-toggle="collapse" data-parent="#accInputsRes" href="#accInpt-2" class="btn BtnBack">Atrás</a>
                            </div> -->
                          </div><!-- end.crad-body -->
                        </div><!-- end.collapse -->
                      </div><!-- end.card -->

                    </div><!-- end.accInputList -->
                  </div><!-- end.contAccordionBox -->
                </div><!-- end.col-* -->
              </div><!-- end.row -->
            </div><!-- end.container -->
          </div><!-- end.detallecompra -->
        </section>
        
        </div>
        <div class="actions clearfix">
          <ul role="menu" aria-label="Pagination">
            <li aria-disabled="false">
              <a href="{{'reservar-5'|page}}">Atrás</a>
            </li>
            <!--li aria-hidden="false" class="constrolsRes btnsNext" aria-disabled="false">
              <button type="submit" data-btn-valid class="btnpr btnpr__primary btnpr__primary--border " id="resumen">
                <i class="fa fa-chevron-right"></i><span>Pagar</span>
              </button>
            </li-->
          </ul><!-- end.ul -->
        </div><!-- end.actions -->
      </div><!-- end.wizard -->
    {{ form_close() }}
  </div><!-- end.reservaCt -->
</article><!-- end.bg-gen -->


<script type="text/javascript">


 
//// agrega funciones a select
     document.addEventListener('DOMContentLoaded', function() {
            const select = document.getElementById('countrySelect');
            const options = select.options;

            // Preseleccionar el primer país después de "Selecciona un país"
            if (options.length > 1) {
                select.selectedIndex = 1;
                updateHiddenFields(options[1]);
            }
            
            // Actualizar campos ocultos al cambiar la selección
            select.addEventListener('change', function() {
                const selectedOption = options[select.selectedIndex];
                updateHiddenFields(selectedOption);
            });
            
        function updateHiddenFields(option) {
                document.getElementById('callingCode').value = option.getAttribute('data-calling-code');
                document.getElementById('countryCode').value = option.getAttribute('data-country-code');
                
                guardar()
            }
        });
        
////////// fin 




     function send(){
        
    //  const promoCode = document.getElementById('promoCode');

            dataLayer.push({'wander': null }); 
            dataLayer.push({'event': 'lead_generated',
                            'wander': {
                              'value': totalFinal,
                             // 'coupon': promoCode.value,
                              }
                        });
                       
    }
      
      
    function search() {
      let email = document.getElementById('email').value;
      
         if (!email) {
          mostrarMensaje('⚠️ Por favor ingresa un correo electrónico.', 'warning');
          return;
        }
    
        if (!validarEmail(email)) {
          mostrarMensaje('⚠️ El correo electrónico no tiene un formato válido.', 'error');
          return;
        }
    
        $('#userMessage').hide();
        $('#userMessageText').text('');
    
        if (email) {    
          let data = {
            email: email
          }
    
          $url = 'https://wandercabins.mx/user/getByEmail';
    
            $.post($url, data, function (response) {
                if (response && Object.keys(response).length > 0) {
                    llenarCampos(response);
                }
            });
            
        }
    
     guardar()

    
    }
         
    function mostrarMensaje(texto, tipo) {
        // tipo: 'success' o 'error'
        const $msg = $('#userMessage');
        const $msgText = $('#userMessageText');
    
        // Limpiar clases alert anteriores
        $msg.removeClass('alert-success alert-danger alert-warning');
    
        // Agregar clase según tipo
        if (tipo === 'success') {
          $msg.addClass('alert-success');
        } else if (tipo === 'error') {
          $msg.addClass('alert-danger');
        } else if (tipo === 'warning') {
          $msg.addClass('alert-warning');
        }
    
        $msgText.text(texto);
        $msg.show();
      }
      
    function llenarCampos(data) {
            if (!data) return;
        
            // Inputs simples
            if (data.nombre_completo) $('#nombre_1').val(data.nombre);
            if (data.apellidos) $('#apellido_1').val(data.apellidos);
            if (data.codigo_postal) $('#cp').val(data.codigo_postal);
            if (data.telefono) $('#telefono_1').val(data.telefono);
        
            if (data.codigo_telefonico) $('#callingCode').val(data.codigo_telefonico);
            if (data.codigo_pais) $('#countryCode').val(data.codigo_pais);
        
            // Fecha de nacimiento (YYYY, MM, DD)
            if (data.nacimiento_a) $('#aa_1').val(data.nacimiento_a);
            if (data.nacimiento_m) $('#mm_1').val(data.nacimiento_m);
            if (data.nacimiento_d) $('#dd_1').val(data.nacimiento_d);
        
            // ======= Seleccionar país en el <select> =======
        
            // 1️⃣ Si tu respuesta tiene el "nombre_pais" EXACTO como el value del select
            if (data.nombre_pais) {
              $('#countrySelect').val(data.nombre_pais);
            }
        
            // 2️⃣ O si tienes el código (ej. "MX") y quieres buscar por data-country-code
            if (data.codigo_pais) {
              $('#countrySelect option').each(function () {
                if ($(this).data('country-code') == data.codigo_pais) {
                  $('#countrySelect').val($(this).val());
                }
              });
            }
            
            
          }
  
  
      function validarEmail(email) {
        const re = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
        return re.test(email);
      }


         
function guardar(){
 // Obtener valores
  let nombre_1       = document.getElementById('nombre_1').value.trim();
  let apellido_1     = document.getElementById('apellido_1').value.trim();
  let dd_1           = document.getElementById('dd_1').value;
  let mm_1           = document.getElementById('mm_1').value;
  let aa_1           = document.getElementById('aa_1').value.trim();
  let telefono_1     = document.getElementById('telefono_1').value.trim();
  let email          = document.getElementById('email').value.trim();
  let codigo_postal  = document.getElementById('cp').value.trim();

  const countryName  = document.getElementById('countrySelect').value;
  const callingCode  = document.getElementById('callingCode').value;
  const countryCode  = document.getElementById('countryCode').value;

  // 🔴 Validar campos obligatorios
  if (
    !nombre_1 || !apellido_1 || !dd_1 || !mm_1 || !aa_1 ||
    !telefono_1 || !email || !codigo_postal
  ) {
    return; // evita alert infinito en onblur
  }
        // 🔴 Email válido
      const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
      if (!emailRegex.test(email)) {
        alert("El correo electrónico no es válido.");
        return;
      }
    
      // 🔴 Fecha numérica
      if (isNaN(dd_1) || isNaN(mm_1) || isNaN(aa_1)) {
        alert("La fecha de nacimiento no es válida.");
        return;
      }
    
      // 🔴 Mes válido
      if (mm_1 < 1 || mm_1 > 12) {
        alert("El mes debe estar entre 1 y 12.");
        return;
      }
    
      // 🔴 Día válido según mes y año
      const diasEnMes = new Date(aa_1, mm_1, 0).getDate();
      if (dd_1 < 1 || dd_1 > diasEnMes) {
        alert(`El día debe estar entre 1 y ${diasEnMes}.`);
        return;
      }
      


      

  let data =  {
      nombre_1 : nombre_1,
      apellido_1 : apellido_1,
      dd_1 : dd_1,
      mm_1 : mm_1,
      aa_1 : aa_1,
      telefono_1 : telefono_1,
      email : email,
      codigo_pais: countryCode,
      codigo_telefonico: callingCode,
      codigo_postal: codigo_postal,
      pais: countryName,
      anonymous: visitorId
  }
   // Verificar si las variables están definidas
   if (nombre_1 && apellido_1 && dd_1 && mm_1 && aa_1 && telefono_1  && email  ) {
    // Realizar la solicitud de guardado solo si todas las variables están definidas
    $.request('onGuardar', {
      data: data,
      success: function(data) {
          
        // Realizar acciones adicionales en caso de éxito        
        send()
      }
    });
  }



}



    const emailInput = document.getElementById('email');
    const suggestionList = document.getElementById('email-suggestions');
    
    const commonDomains = ['gmail.com', 'yahoo.com', 'hotmail.com', 'outlook.com', 'icloud.com'];
    
    emailInput.addEventListener('input', function() {
      const value = this.value;
      suggestionList.innerHTML = ''; // Clear previous suggestions
    
      const atIndex = value.indexOf('@');
    
      if (atIndex !== -1) {
        const enteredDomain = value.slice(atIndex + 1).toLowerCase();
    
        commonDomains.forEach(domain => {
          if (domain.startsWith(enteredDomain)) {
            const suggestion = document.createElement('option');
            suggestion.value = value.slice(0, atIndex + 1) + domain;
            suggestionList.appendChild(suggestion);
          }
        });
      }
    });
    
    
      let klaviyoSent = false;

      function onReservaSuccess(data) {
        if (klaviyoSent) return;
        /*klaviyoSent = true;
    
             {% set guest = (adultos ?? 0) + (ninos ?? 0) %}

             klaviyo.track("Started_Reservation", {
             "cabin_name": '{{ cabana.nombre }}', 
             "nights": '{{ noches }}', 
             "guests": '{{ guest }}', 
             "start_date": '{{ start }}', 
             "end_date": '{{ end }}', 
             "location":      '{{ ubicacion.nombre }}', 
             "total_price":   {{ total }},
             "$value":  {{ total }},
             "currency":   'MXN',
           });*/
           
      }
        
        
    


  </script>
  
  
  
<script>

// 🚦 Flag para saber si la navegación es interna
window._internalNavigation = false;

// 1️⃣ Detectar clicks en enlaces internos
document.querySelectorAll('a').forEach(link => {
    if (link.href.startsWith(window.location.origin)) {
        link.addEventListener('click', () => {
            window._internalNavigation = true;
        });
    }
});

// 2️⃣ Detectar envíos de formularios internos
document.querySelectorAll('form').forEach(form => {
    form.addEventListener('submit', () => {
        if (!window._internalNavigation) {
            // Por defecto, un submit se considera interno si es tu booking
            // Opcional: podrías filtrar solo formularios del booking
            window._internalNavigation = true;
        }
    });
});

// 3️⃣ Detectar clicks en botones "Siguiente" específicos
document.getElementById('servicios')?.addEventListener('click', () => {
    window._internalNavigation = true; // ✅ Marca navegación interna
});

document.getElementById('servicios-2')?.addEventListener('click', () => {
    window._internalNavigation = true; // ✅ Marca navegación interna
});

// 4️⃣ Detectar cierre o abandono de página
window.addEventListener('beforeunload', function (e) {
    if (window._internalNavigation) return;

    const visitorId = localStorage.getItem('visitor_id');
    const data = {
        event_name: 'Abandon_Cart',
        wander: visitorId,
        with_session_tags => true,
        properties: {
            abandoned_step: 'Paso 6',
            page: window.location.pathname
        }
    };

    // Opción 1: sendBeacon (la más confiable para beforeunload)
    if (navigator.sendBeacon) {
        const blob = new Blob([JSON.stringify(data)], { type: 'application/json' });
        navigator.sendBeacon('/klaviyo/event', blob);
    } else {
        // Fallback con keepalive
        fetch('/klaviyo/event', {
            method: 'POST',
            body: JSON.stringify(data),
            keepalive: true,
            headers: { 'Content-Type': 'application/json' }
        });
    }
});




document.addEventListener('DOMContentLoaded', function () {
   {% set guest = (adultos ?? 0) + (ninos ?? 0) %}
   var klaviyoTags = {{ klaviyo_tags | raw }};


    const reservationData = Object.assign({
        cabin_name: '{{ cabana.nombre }}',
        nights: '{{ noches }}',
        guests: '{{ guest }}',
        start_date: '{{ start }}',
        end_date: '{{ end }}',
        location: '{{ ubicacion.nombre }}',
        total_price: {{ total }},
        $value: {{ total }},
        currency: 'MXN'
    }, klaviyoTags);

    // Crear hash simple de los datos
    const dataHash = JSON.stringify(reservationData);
    const lastSent = sessionStorage.getItem('Started_Cart_hash');

    if (lastSent !== dataHash) {
        klaviyo.track("Started_Cart", reservationData);
        sessionStorage.setItem('Started_Cart_hash', dataHash);
        console.log('📤 Started_Cart_hash enviado');
    } else {
        console.log('⏭️ Started_Cart_hash sin cambios, no se reenvió');
    }
});


</script>